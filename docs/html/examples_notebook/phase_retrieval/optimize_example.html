

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phase retrieval problem &mdash; SVETlANNa 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Phase retrieval problem: low API example" href="optimize_lowapi_example.html" />
    <link rel="prev" title="Examples of phase retrieval algorithms" href="../../phase_retrieval_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SVETlANNa
              <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../physics.html">Physical Basis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../freeprop_examples.html">Examples of solving forward light propagation problems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../phase_retrieval_examples.html">Examples of phase retrieval algorithms</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Phase retrieval problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Creating-numerical-mesh-with-using-SimulationParameters-class">Creating numerical mesh with using <code class="docutils literal notranslate"><span class="pre">SimulationParameters</span></code> class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Solving-a-direct-problem">Solving a direct problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Solving-phase-retrieval-problem">Solving phase retrieval problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Solving-direct-problem-with-founded-phase-profile">Solving direct problem with founded phase profile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="optimize_lowapi_example.html">Phase retrieval problem: low API example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../network_examples.html">Examples of diffractive optical networks</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SVETlANNa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../examples.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../../phase_retrieval_examples.html">Examples of phase retrieval algorithms</a></li>
      <li class="breadcrumb-item active">Phase retrieval problem</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples_notebook/phase_retrieval/optimize_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna.phase_retrieval_problem</span><span class="w"> </span><span class="kn">import</span> <span class="n">phase_retrieval</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationParameters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">Wavefront</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">elements</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearOpticalSetup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">ureg</span>
</pre></div>
</div>
</div>
<section id="Phase-retrieval-problem">
<h1>Phase retrieval problem<a class="headerlink" href="#Phase-retrieval-problem" title="Link to this heading"></a></h1>
<p>Consider an optical system consisting of a source generating a Gaussian beam, a collecting lens, and a screen located in the rear focal plane of the lens.</p>
<p>First, let us solve the forward problem and see what intensity distribution will be obtained if a beam passes through such a system. Then let us solve the inverse problem using <code class="docutils literal notranslate"><span class="pre">svetlanna.phase_retrieval</span></code> module: knowing the intensity distribution on the screen after the passage of the optical system described above and the intensity distribution in the plane after the lens, let us try to find the transmission function of the lens</p>
<section id="Creating-numerical-mesh-with-using-SimulationParameters-class">
<h2>Creating numerical mesh with using <code class="docutils literal notranslate"><span class="pre">SimulationParameters</span></code> class<a class="headerlink" href="#Creating-numerical-mesh-with-using-SimulationParameters-class" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[188]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># optical setup size</span>
<span class="n">lx</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span>
<span class="n">ly</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span>

<span class="c1"># number of nodes</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="mi">1024</span>

<span class="c1"># wavelength</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mi">1064</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">nm</span>

<span class="c1"># focal distance of the lens</span>
<span class="n">focal</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">cm</span>
<span class="c1"># radius of the lens</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">cm</span>
<span class="c1"># distance between the screen and the lens</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">focal</span> <span class="o">*</span> <span class="mf">1.</span>

<span class="c1"># waist radius of the gaussian beam</span>
<span class="n">w0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span>

<span class="c1"># creating SimulationParameters exemplar</span>
<span class="n">sim_params</span> <span class="o">=</span> <span class="n">SimulationParameters</span><span class="p">({</span>
    <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Nx</span><span class="p">),</span>
    <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ly</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ly</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Ny</span><span class="p">),</span>
    <span class="s1">&#39;wavelength&#39;</span><span class="p">:</span> <span class="n">wavelength</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[189]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># return 2d-tensors of x and y coordinates</span>
<span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Solving-a-direct-problem">
<h2>Solving a direct problem<a class="headerlink" href="#Solving-a-direct-problem" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[190]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">incident_wavefront</span> <span class="o">=</span> <span class="n">Wavefront</span><span class="o">.</span><span class="n">gaussian_beam</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">sim_params</span><span class="p">,</span>
    <span class="n">waist_radius</span><span class="o">=</span><span class="n">w0</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="n">distance</span>
<span class="p">)</span>

<span class="n">source_intensity</span> <span class="o">=</span> <span class="n">incident_wavefront</span><span class="o">.</span><span class="n">intensity</span>

<span class="n">lens</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">ThinLens</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">sim_params</span><span class="p">,</span>
    <span class="n">focal_length</span><span class="o">=</span><span class="n">focal</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="n">r</span>
<span class="p">)</span>

<span class="n">field_after_lens</span> <span class="o">=</span> <span class="n">lens</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">incident_wavefront</span><span class="p">)</span>

<span class="n">free_space</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">FreeSpace</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">sim_params</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;AS&quot;</span>
<span class="p">)</span>

<span class="n">output_field</span> <span class="o">=</span> <span class="n">free_space</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">field_after_lens</span><span class="p">)</span>

<span class="n">target_intensity</span> <span class="o">=</span> <span class="n">output_field</span><span class="o">.</span><span class="n">intensity</span>
</pre></div>
</div>
</div>
<p>Creating optical setup that describes field propagation from source to the screen</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[191]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optical_setup</span> <span class="o">=</span> <span class="n">LinearOpticalSetup</span><span class="p">([</span><span class="n">free_space</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="Solving-phase-retrieval-problem">
<h2>Solving phase retrieval problem<a class="headerlink" href="#Solving-phase-retrieval-problem" title="Link to this heading"></a></h2>
<p>In order to solve the phase retrieval problem it’s necessary to define the <code class="docutils literal notranslate"><span class="pre">source_intensity</span></code>, <code class="docutils literal notranslate"><span class="pre">target_intensity</span></code> and optimization method in <code class="docutils literal notranslate"><span class="pre">phase_retrieval.retrieve_phase</span></code> function. Optionally, you can define algorithm’s parameters using <code class="docutils literal notranslate"><span class="pre">options</span></code> parameter. You must pass the dict with key arguments</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[192]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_gs</span> <span class="o">=</span> <span class="n">phase_retrieval</span><span class="o">.</span><span class="n">retrieve_phase</span><span class="p">(</span>
    <span class="n">source_intensity</span><span class="o">=</span><span class="n">source_intensity</span><span class="p">,</span>
    <span class="n">optical_setup</span><span class="o">=</span><span class="n">optical_setup</span><span class="p">,</span>
    <span class="n">target_intensity</span><span class="o">=</span><span class="n">target_intensity</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GS&#39;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">1e-16</span><span class="p">,</span>
        <span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[193]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phase_distribution_gs</span> <span class="o">=</span> <span class="n">result_gs</span><span class="o">.</span><span class="n">solution</span>

<span class="n">niter_gs</span> <span class="o">=</span> <span class="n">result_gs</span><span class="o">.</span><span class="n">number_of_iterations</span>

<span class="n">error_mass_gs</span> <span class="o">=</span> <span class="n">result_gs</span><span class="o">.</span><span class="n">cost_func_evolution</span>
</pre></div>
</div>
</div>
</section>
<section id="Solving-direct-problem-with-founded-phase-profile">
<h2>Solving direct problem with founded phase profile<a class="headerlink" href="#Solving-direct-problem-with-founded-phase-profile" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[194]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">DiffractiveLayer</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">sim_params</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="n">phase_distribution_gs</span>
<span class="p">)</span>

<span class="n">field_after_layer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">incident_wavefront</span><span class="p">)</span>
<span class="n">output_field_retrieved</span> <span class="o">=</span> <span class="n">free_space</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">field_after_layer</span><span class="p">)</span>

<span class="n">target_intensity_retrieved</span> <span class="o">=</span> <span class="n">output_field_retrieved</span><span class="o">.</span><span class="n">intensity</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[195]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">scale_factor</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">x_grid_scaled</span> <span class="o">=</span> <span class="n">x_grid</span> <span class="o">*</span> <span class="n">scale_factor</span>
<span class="n">y_grid_scaled</span> <span class="o">=</span> <span class="n">y_grid</span> <span class="o">*</span> <span class="n">scale_factor</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_grid_scaled</span><span class="p">,</span> <span class="n">y_grid_scaled</span><span class="p">,</span> <span class="n">target_intensity_retrieved</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Intensity distribution on the screen&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [$10^{-5}$ m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [$10^{-5}$ m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_grid_scaled</span><span class="p">,</span> <span class="n">y_grid_scaled</span><span class="p">,</span> <span class="n">target_intensity</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Target intensity distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [$10^{-5}$ m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [$10^{-5}$ m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">w0</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_phase_retrieval_optimize_example_14_0.png" src="../../_images/examples_notebook_phase_retrieval_optimize_example_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[196]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">phase_distribution_gs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Founded phase distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [m]&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lens</span><span class="o">.</span><span class="n">transmission_function</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1</span><span class="n">j</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Lens phase distribution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [mm]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [mm]&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[196]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x2689c55bb50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_phase_retrieval_optimize_example_15_1.png" src="../../_images/examples_notebook_phase_retrieval_optimize_example_15_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[197]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">8.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Optimize result&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;cost function value&#39;</span><span class="p">)</span>

<span class="n">n_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">niter_gs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">n_gs</span><span class="p">,</span> <span class="n">error_mass_gs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GS&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[197]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x2689c5db950&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_phase_retrieval_optimize_example_16_1.png" src="../../_images/examples_notebook_phase_retrieval_optimize_example_16_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../phase_retrieval_examples.html" class="btn btn-neutral float-left" title="Examples of phase retrieval algorithms" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="optimize_lowapi_example.html" class="btn btn-neutral float-right" title="Phase retrieval problem: low API example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, CompPhysLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>