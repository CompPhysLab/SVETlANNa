

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Use of a nonlinear element &mdash; SVETlANNa 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Diffraction on the thin slit" href="rectangular_slit_propagation.html" />
    <link rel="prev" title="Gaussain Beam propagation" href="gaussian_beam_propagation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SVETlANNa
              <img src="../../_static/logo.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../physics.html">Physical Basis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../freeprop_examples.html">Examples of solving forward light propagation problems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="apertures.html">Diffraction on the apertures</a></li>
<li class="toctree-l3"><a class="reference internal" href="lens.html">Lens</a></li>
<li class="toctree-l3"><a class="reference internal" href="gaussian_beam_propagation.html">Gaussain Beam propagation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Use of a nonlinear element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Creating-numerical-mesh-with-using-SimulationParameters-class">Creating numerical mesh with using <code class="docutils literal notranslate"><span class="pre">SimulationParameters</span></code> class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Creating-a-Gaussian-beam-using-svetlanna.wavefront.gaussian_beam">Creating a Gaussian beam using <code class="docutils literal notranslate"><span class="pre">svetlanna.wavefront.gaussian_beam</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Creating-nonlinear-element-using-svetlanna.elements.NonlinearElement">Creating nonlinear element using <code class="docutils literal notranslate"><span class="pre">svetlanna.elements.NonlinearElement</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Training-the-parameters-of-the-response-function">Training the parameters of the response function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rectangular_slit_propagation.html">Diffraction on the thin slit</a></li>
<li class="toctree-l3"><a class="reference internal" href="slm.html">Use of SLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="square_aperture_propagation.html">Propagation through the square aperture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../phase_retrieval_examples.html">Examples of phase retrieval algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network_examples.html">Examples of diffractive optical networks</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SVETlANNa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../examples.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../../freeprop_examples.html">Examples of solving forward light propagation problems</a></li>
      <li class="breadcrumb-item active">Use of a nonlinear element</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples_notebook/freeprop/nonlinear_element.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">elements</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationParameters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna</span><span class="w"> </span><span class="kn">import</span> <span class="n">wavefront</span> <span class="k">as</span> <span class="n">w</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">svetlanna.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">ureg</span>
</pre></div>
</div>
</div>
<section id="Use-of-a-nonlinear-element">
<h1>Use of a nonlinear element<a class="headerlink" href="#Use-of-a-nonlinear-element" title="Link to this heading"></a></h1>
<p>The nonlinear element allows to control the intensity of the incident wavefront while preserving the phase distribution. For the aim to define the nonlinear element, it’s necessary to pass the intensity <code class="docutils literal notranslate"><span class="pre">response_function</span></code>. For example, we will use the sigmoid function as a response function and the gaussian beam as an incident wavefront:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">response_sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">10</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<section id="Creating-numerical-mesh-with-using-SimulationParameters-class">
<h2>Creating numerical mesh with using <code class="docutils literal notranslate"><span class="pre">SimulationParameters</span></code> class<a class="headerlink" href="#Creating-numerical-mesh-with-using-SimulationParameters-class" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wavelength</span> <span class="o">=</span> <span class="mi">1064</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">nm</span> <span class="c1"># wavelength, mm</span>
<span class="n">lx</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span> <span class="c1"># screen size along x-axis, mm</span>
<span class="n">ly</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span> <span class="c1"># screen size along y-axis, mm</span>

<span class="n">Nx</span> <span class="o">=</span> <span class="mi">1200</span> <span class="c1"># number of nodes along x-axis</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="mi">1100</span> <span class="c1"># number of nodes along y-axis</span>

<span class="n">x_length</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span>
<span class="n">y_length</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ly</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ly</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span>

<span class="c1"># define simulation parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">SimulationParameters</span><span class="p">(</span>
    <span class="n">axes</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="n">x_length</span><span class="p">,</span>
            <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">y_length</span><span class="p">,</span>
            <span class="s1">&#39;wavelength&#39;</span><span class="p">:</span> <span class="n">wavelength</span>
        <span class="p">}</span>
<span class="p">)</span>
<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Creating-a-Gaussian-beam-using-svetlanna.wavefront.gaussian_beam">
<h2>Creating a Gaussian beam using <code class="docutils literal notranslate"><span class="pre">svetlanna.wavefront.gaussian_beam</span></code><a class="headerlink" href="#Creating-a-Gaussian-beam-using-svetlanna.wavefront.gaussian_beam" title="Link to this heading"></a></h2>
<p>Let’s create a Gaussian beam that will fall on the nonlinear element:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">incident_wavefront</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">Wavefront</span><span class="o">.</span><span class="n">gaussian_beam</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">waist_radius</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">cm</span>
<span class="p">)</span>
<span class="n">intensity_input</span> <span class="o">=</span> <span class="n">incident_wavefront</span><span class="o">.</span><span class="n">intensity</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span><span class="p">,</span> <span class="n">intensity_input</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity of the incident wavefront&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [m]&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x1d901aa16d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_freeprop_nonlinear_element_7_1.png" src="../../_images/examples_notebook_freeprop_nonlinear_element_7_1.png" />
</div>
</div>
</section>
<section id="Creating-nonlinear-element-using-svetlanna.elements.NonlinearElement">
<h2>Creating nonlinear element using <code class="docutils literal notranslate"><span class="pre">svetlanna.elements.NonlinearElement</span></code><a class="headerlink" href="#Creating-nonlinear-element-using-svetlanna.elements.NonlinearElement" title="Link to this heading"></a></h2>
<p>In this section we will create a nonlinear element with determined intensity response_function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nl_element</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">NonlinearElement</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">response_function</span><span class="o">=</span><span class="n">response_sigmoid</span>
<span class="p">)</span>

<span class="n">transmitted_wavefront</span> <span class="o">=</span> <span class="n">nl_element</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">incident_wavefront</span><span class="p">)</span>
<span class="n">intensity_output</span> <span class="o">=</span> <span class="n">transmitted_wavefront</span><span class="o">.</span><span class="n">intensity</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span><span class="p">,</span> <span class="n">intensity_output</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity of the transmitted wavefront&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [m]&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x1d901ac6510&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_freeprop_nonlinear_element_10_1.png" src="../../_images/examples_notebook_freeprop_nonlinear_element_10_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Intensity of the transmitted wavefront along x-axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xv</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">intensity_output</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transmitted wavefront&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xv</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">intensity_input</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;incident wavefront&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$intesnity$&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$intesnity$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_freeprop_nonlinear_element_11_1.png" src="../../_images/examples_notebook_freeprop_nonlinear_element_11_1.png" />
</div>
</div>
</section>
<section id="Training-the-parameters-of-the-response-function">
<h2>Training the parameters of the response function<a class="headerlink" href="#Training-the-parameters-of-the-response-function" title="Link to this heading"></a></h2>
<p>If it’s necessary to train parameters of the response function, you can pass them into nonlinear element <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method using <code class="docutils literal notranslate"><span class="pre">Dict</span></code> and <code class="docutils literal notranslate"><span class="pre">Parameter</span> <span class="pre">object</span></code>. Parameter of other types can not be trained.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">arbitrary_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">parameter1</span><span class="p">,</span> <span class="n">parameter2</span><span class="p">,</span> <span class="n">parameter3</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">parameter1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">parameter2</span><span class="p">))</span> <span class="o">+</span> <span class="n">parameter3</span> <span class="o">-</span> <span class="mi">150</span>

<span class="n">nl_to_train</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">NonlinearElement</span><span class="p">(</span>
    <span class="n">simulation_parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">response_function</span><span class="o">=</span><span class="n">arbitrary_function</span><span class="p">,</span>
    <span class="n">response_parameters</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;parameter1&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">100.</span><span class="p">),</span>
        <span class="s2">&quot;parameter2&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">40.</span><span class="p">),</span>
        <span class="s2">&quot;parameter3&quot;</span><span class="p">:</span> <span class="mf">100.</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">output_field_to_train</span> <span class="o">=</span> <span class="n">nl_to_train</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">incident_wavefront</span><span class="o">=</span><span class="n">incident_wavefront</span><span class="p">)</span>
<span class="n">intensity_output_to_train</span> <span class="o">=</span> <span class="n">output_field_to_train</span><span class="o">.</span><span class="n">intensity</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span><span class="p">,</span> <span class="n">intensity_output_to_train</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intensity of the transmitted wavefront&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [m]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [m]&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x1d902cd3990&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_freeprop_nonlinear_element_14_1.png" src="../../_images/examples_notebook_freeprop_nonlinear_element_14_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Intensity of the transmitted wavefront along x-axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xv</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">intensity_output_to_train</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transmitted wavefront&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xv</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">intensity_input</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;incident wavefront&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [mm]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$intesnity$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$intesnity$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebook_freeprop_nonlinear_element_15_1.png" src="../../_images/examples_notebook_freeprop_nonlinear_element_15_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gaussian_beam_propagation.html" class="btn btn-neutral float-left" title="Gaussain Beam propagation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rectangular_slit_propagation.html" class="btn btn-neutral float-right" title="Diffraction on the thin slit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, CompPhysLab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>